pipeline {
    agent any

    environment {
        SERVICE_NAME = "config-server"
        IMAGE_NAME = "config-server-miyembro"
        IMAGE_TAG = "${IMAGE_NAME}:${BUILD_NUMBER}"
        REPOSITORY_TAG = "${DOCKERHUB_USERNAME}/${IMAGE_TAG}"
        DOCKER_HUB_CREDS = credentials('miyembro-docker-token')
        STACK_NAME = "miyembro"
    }

    stages {
        stage('Verify Environment') {
            steps {
                script {
                    echo "Checking required environment variables"
                    echo "ORGANIZATION_NAME: ${ORGANIZATION_NAME ?: 'NOT SET'}"
                    echo "DOCKERHUB_USERNAME: ${DOCKERHUB_USERNAME ?: 'NOT SET'}"

                    // Fail early if required vars are missing
                    if (!env.ORGANIZATION_NAME?.trim()) {
                        error("ORGANIZATION_NAME is required but not set")
                    }
                    if (!env.DOCKERHUB_USERNAME?.trim()) {
                        error("DOCKERHUB_USERNAME is required but not set")
                    }
                }
            }
        }

        // Rest of your stages...
    }
}